<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MD â€” Markdown Editor</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- highlight.js theme (swapped by JS on theme toggle) -->
  <link id="hljs-theme" rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

  <!-- marked + highlight.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
    /* â”€â”€ reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: 'Inter', system-ui, sans-serif; overflow: hidden; }

    /* â”€â”€ theme tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    [data-theme="dark"] {
      --bg-app:     #0d1117;
      --bg-bar:     #161b22;
      --bg-editor:  #0d1117;
      --bg-preview: #0d1117;
      --bg-code:    #161b22;
      --bg-hover:   #21262d;
      --border:     #30363d;
      --text:       #e6edf3;
      --muted:      #8b949e;
      --accent:     #58a6ff;
      --accent-dim: rgba(88,166,255,.12);
      --scroll:     #30363d;
      --table-alt:  #161b22;
      --bq-border:  #388bfd;
      --sel:        rgba(88,166,255,.25);
      --hljs-dark:  url('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css');
    }
    [data-theme="light"] {
      --bg-app:     #ffffff;
      --bg-bar:     #f6f8fa;
      --bg-editor:  #f6f8fa;
      --bg-preview: #ffffff;
      --bg-code:    #eef0f2;
      --bg-hover:   #eaeef2;
      --border:     #d0d7de;
      --text:       #1f2328;
      --muted:      #656d76;
      --accent:     #0969da;
      --accent-dim: rgba(9,105,218,.08);
      --scroll:     #c8d0d9;
      --table-alt:  #f6f8fa;
      --bq-border:  #0969da;
      --sel:        rgba(9,105,218,.18);
    }

    /* â”€â”€ transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body, header, footer, textarea, #preview, .pane-label, pre, code {
      transition: background .2s, color .2s, border-color .2s;
    }

    /* â”€â”€ layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      display: flex;
      flex-direction: column;
      background: var(--bg-app);
      color: var(--text);
    }

    /* â”€â”€ top bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 8px;
      height: 48px;
      padding: 0 16px;
      background: var(--bg-bar);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      user-select: none;
    }
    .logo {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 3px;
      color: var(--accent);
      padding-right: 8px;
    }
    .sep { width: 1px; height: 20px; background: var(--border); margin: 0 4px; flex-shrink: 0; }
    .spacer { flex: 1; }

    /* buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      font: 12px/1 'Inter', system-ui, sans-serif;
      cursor: pointer;
      white-space: nowrap;
      transition: background .15s, color .15s, border-color .15s;
    }
    .btn:hover { background: var(--bg-hover); color: var(--text); border-color: var(--accent); }
    .btn.ghost  { border-color: transparent; }
    .btn.ghost:hover { border-color: var(--border); }
    .btn.accent { color: var(--accent); border-color: var(--accent); }
    .btn.icon   { padding: 5px 7px; border: none; font-size: 15px; }
    .btn.icon:hover { background: var(--bg-hover); border: none; }

    .stats-badge {
      font: 11px/1 'JetBrains Mono', monospace;
      color: var(--muted);
      padding: 4px 8px;
    }

    /* â”€â”€ split pane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .pane {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-width: 80px;
      overflow: hidden;
    }
    .pane-label {
      font: 600 9.5px/1 'Inter', system-ui, sans-serif;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--muted);
      padding: 6px 20px 5px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-bar);
      flex-shrink: 0;
    }

    /* editor */
    #editor {
      flex: 1;
      padding: 24px;
      background: var(--bg-editor);
      color: var(--text);
      border: none;
      outline: none;
      resize: none;
      font: 13.5px/1.8 'JetBrains Mono', 'Fira Code', monospace;
      tab-size: 2;
      overflow-y: auto;
    }
    #editor::selection { background: var(--sel); }

    /* drag handle */
    .handle {
      width: 4px;
      background: var(--border);
      cursor: col-resize;
      flex-shrink: 0;
      position: relative;
      transition: background .15s;
    }
    /* wider invisible grab zone */
    .handle::after {
      content: '';
      position: absolute;
      inset: 0 -4px;
    }
    .handle:hover, .handle.dragging { background: var(--accent); }

    /* preview pane */
    #preview-scroll {
      flex: 1;
      overflow-y: auto;
      background: var(--bg-preview);
    }
    #preview {
      max-width: 760px;
      margin: 0 auto;
      padding: 32px 40px;
      font-size: 15px;
      line-height: 1.75;
    }

    /* â”€â”€ scrollbars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #editor::-webkit-scrollbar,
    #preview-scroll::-webkit-scrollbar { width: 5px; }
    #editor::-webkit-scrollbar-thumb,
    #preview-scroll::-webkit-scrollbar-thumb {
      background: var(--scroll); border-radius: 3px;
    }

    /* â”€â”€ preview typography â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #preview h1,#preview h2,#preview h3,
    #preview h4,#preview h5,#preview h6 {
      color: var(--text);
      margin: 28px 0 10px;
      line-height: 1.3;
      font-weight: 600;
    }
    #preview h1 { font-size: 2em;   border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    #preview h2 { font-size: 1.45em; border-bottom: 1px solid var(--border); padding-bottom: 6px; }
    #preview h3 { font-size: 1.2em; }
    #preview p  { margin: 12px 0; }
    #preview a  { color: var(--accent); text-decoration: none; }
    #preview a:hover { text-decoration: underline; }
    #preview ul, #preview ol { padding-left: 1.8em; margin: 10px 0; }
    #preview li { margin: 5px 0; }
    #preview li input[type="checkbox"] { margin-right: 6px; accent-color: var(--accent); }
    #preview blockquote {
      border-left: 3px solid var(--bq-border);
      margin: 16px 0;
      padding: 6px 16px;
      color: var(--muted);
      background: var(--accent-dim);
      border-radius: 0 6px 6px 0;
    }
    #preview hr { border: none; border-top: 1px solid var(--border); margin: 24px 0; }
    #preview code {
      font-family: 'JetBrains Mono', monospace;
      font-size: .875em;
      background: var(--bg-code);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--accent);
    }
    #preview pre {
      background: var(--bg-code) !important;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow-x: auto;
      margin: 16px 0;
    }
    #preview pre code {
      background: transparent !important;
      padding: 16px 20px;
      display: block;
      font-size: 13px;
      line-height: 1.7;
      color: var(--text);
    }
    #preview table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 14px;
    }
    #preview th {
      background: var(--bg-bar);
      color: var(--text);
      font-weight: 600;
      padding: 8px 14px;
      border: 1px solid var(--border);
      text-align: left;
    }
    #preview td { padding: 7px 14px; border: 1px solid var(--border); }
    #preview tr:nth-child(even) td { background: var(--table-alt); }
    #preview img { max-width: 100%; border-radius: 6px; margin: 8px 0; }

    /* â”€â”€ status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      display: flex;
      align-items: center;
      gap: 16px;
      height: 26px;
      padding: 0 16px;
      background: var(--bg-bar);
      border-top: 1px solid var(--border);
      flex-shrink: 0;
      font: 11px/1 'JetBrains Mono', monospace;
      color: var(--muted);
    }

    /* â”€â”€ URL modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(4px);
      z-index: 200;
      align-items: center;
      justify-content: center;
    }
    .overlay.open { display: flex; }
    .modal {
      background: var(--bg-bar);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 24px;
      width: 480px;
      max-width: 90vw;
      box-shadow: 0 24px 64px rgba(0,0,0,.5);
    }
    .modal h3 { font-size: 13px; margin-bottom: 14px; color: var(--text); }
    .modal input[type="text"] {
      width: 100%;
      padding: 8px 12px;
      background: var(--bg-app);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      font: 13px/1 'JetBrains Mono', monospace;
      outline: none;
      margin-bottom: 12px;
      transition: border-color .15s;
    }
    .modal input:focus { border-color: var(--accent); }
    .modal-row { display: flex; gap: 8px; justify-content: flex-end; }

    /* â”€â”€ toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%) translateY(12px);
      background: var(--bg-bar);
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 13px;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 8px 32px rgba(0,0,0,.35);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s, transform .2s;
      z-index: 999;
      white-space: nowrap;
    }
    #toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>

<!-- â”€â”€ top bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <span class="logo">MD</span>
  <div class="sep"></div>

  <!-- load local file -->
  <label class="btn" title="Load a .md file from your computer">
    <svg width="13" height="13" fill="currentColor" viewBox="0 0 16 16">
      <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
      <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
    </svg>
    Load File
    <input type="file" id="file-input" accept=".md,.txt,.markdown" hidden>
  </label>

  <!-- load from URL -->
  <button class="btn" id="btn-url" title="Load markdown from a URL">
    <svg width="13" height="13" fill="currentColor" viewBox="0 0 16 16">
      <path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
      <path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
    </svg>
    URL
  </button>

  <!-- shortcut: load ARCHITECTURE.md -->
  <button class="btn" id="btn-arch" title="Load the meeting processor architecture doc">
    <svg width="13" height="13" fill="currentColor" viewBox="0 0 16 16">
      <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
    </svg>
    ARCHITECTURE.md
  </button>

  <div class="spacer"></div>
  <span class="stats-badge" id="stats">â€”</span>
  <div class="sep"></div>

  <!-- theme toggle -->
  <button class="btn icon" id="btn-theme" title="Toggle dark / light theme">ðŸŒ™</button>
</header>

<!-- â”€â”€ split pane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="main" id="main">

  <div class="pane" id="editor-pane">
    <div class="pane-label">Editor</div>
    <textarea id="editor" spellcheck="false" placeholder="Start writing markdownâ€¦"></textarea>
  </div>

  <div class="handle" id="handle"></div>

  <div class="pane" id="preview-pane">
    <div class="pane-label">Preview</div>
    <div id="preview-scroll">
      <div id="preview"></div>
    </div>
  </div>

</div>

<!-- â”€â”€ status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<footer>
  <span id="s-words">words: 0</span>
  <span id="s-chars">chars: 0</span>
  <span id="s-lines">lines: 0</span>
  <div class="spacer"></div>
  <span id="s-file">no file loaded</span>
  <span id="s-theme">dark</span>
</footer>

<!-- â”€â”€ URL modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="overlay" id="url-overlay">
  <div class="modal">
    <h3>Load Markdown from URL</h3>
    <input type="text" id="url-input"
      placeholder="https://raw.githubusercontent.com/â€¦/file.md">
    <div class="modal-row">
      <button class="btn" id="btn-url-cancel">Cancel</button>
      <button class="btn accent" id="btn-url-load">Load</button>
    </div>
  </div>
</div>

<!-- â”€â”€ toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ARCH_PATH = './meeting-processor/ARCHITECTURE.md';

const DEFAULT_MD = `# Welcome to MD

A **minimal, distraction-free** markdown editor â€” live preview, dark/light theme, draggable pane.

## How to use

- **Load File** â€” open any \`.md\` from your computer
- **URL** â€” paste a raw GitHub URL
- **ARCHITECTURE.md** â€” load the meeting processor docs from this repo
- **ðŸŒ™ / â˜€** â€” toggle dark / light
- **Drag** the center bar to resize panes

## Example

\`\`\`bash
# Drop a video â†’ get AI meeting notes
cp standup.mp4 ~/Desktop/Videos/

# Watch progress
tail -f ~/meeting-processor/processor.log
\`\`\`

| Tool    | Cost        | Runs locally? |
|---------|-------------|---------------|
| ffmpeg  | Free        | âœ“             |
| Whisper | Free        | âœ“             |
| Claude  | ~$0.02/mtg  | âœ— (API)       |

> **Tip:** click **ARCHITECTURE.md** in the toolbar to see the full pipeline diagram.

- [x] Build MD viewer
- [x] Dark / light theme
- [x] Draggable split pane
- [x] Syntax highlighted code
- [ ] Add more tools to \`bunlongheng/tools\`
`;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MARKED SETUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
marked.setOptions({
  gfm: true,
  breaks: true,
  highlight(code, lang) {
    if (lang && hljs.getLanguage(lang)) {
      return hljs.highlight(code, { language: lang }).value;
    }
    return hljs.highlightAuto(code).value;
  },
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const editor       = document.getElementById('editor');
const preview      = document.getElementById('preview');
const previewScroll= document.getElementById('preview-scroll');
const btnTheme     = document.getElementById('btn-theme');
const fileInput    = document.getElementById('file-input');
const btnUrl       = document.getElementById('btn-url');
const urlOverlay   = document.getElementById('url-overlay');
const urlInput     = document.getElementById('url-input');
const btnUrlLoad   = document.getElementById('btn-url-load');
const btnUrlCancel = document.getElementById('btn-url-cancel');
const btnArch      = document.getElementById('btn-arch');
const handle       = document.getElementById('handle');
const editorPane   = document.getElementById('editor-pane');
const previewPane  = document.getElementById('preview-pane');
const sWords       = document.getElementById('s-words');
const sChars       = document.getElementById('s-chars');
const sLines       = document.getElementById('s-lines');
const sFile        = document.getElementById('s-file');
const sThemeEl     = document.getElementById('s-theme');
const statsEl      = document.getElementById('stats');
const hljsTheme    = document.getElementById('hljs-theme');
const toastEl      = document.getElementById('toast');
const htmlEl       = document.documentElement;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function toast(msg) {
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toastEl.classList.remove('show'), 2400);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER â€” live as you type
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const md = editor.value;
  preview.innerHTML = marked.parse(md);

  // Re-run highlight on any blocks marked missed
  preview.querySelectorAll('pre code:not(.hljs)').forEach(el => hljs.highlightElement(el));

  // Stats
  const words = md.trim() ? md.trim().split(/\s+/).length : 0;
  sWords.textContent = `words: ${words.toLocaleString()}`;
  sChars.textContent = `chars: ${md.length.toLocaleString()}`;
  sLines.textContent = `lines: ${md.split('\n').length.toLocaleString()}`;
  statsEl.textContent = `${words.toLocaleString()} words`;
}

editor.addEventListener('input', render);

// Tab â†’ 2 spaces (instead of focus-jumping)
editor.addEventListener('keydown', e => {
  if (e.key !== 'Tab') return;
  e.preventDefault();
  const s = editor.selectionStart, end = editor.selectionEnd;
  editor.value = editor.value.slice(0, s) + '  ' + editor.value.slice(end);
  editor.selectionStart = editor.selectionEnd = s + 2;
  render();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DARK_CSS  = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css';
const LIGHT_CSS = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css';
let dark = true;

function applyTheme(isDark) {
  dark = isDark;
  htmlEl.setAttribute('data-theme', dark ? 'dark' : 'light');
  btnTheme.textContent = dark ? 'â˜€' : 'ðŸŒ™';
  hljsTheme.href = dark ? DARK_CSS : LIGHT_CSS;
  sThemeEl.textContent = dark ? 'dark' : 'light';
  localStorage.setItem('md-theme', dark ? 'dark' : 'light');
}

btnTheme.addEventListener('click', () => applyTheme(!dark));

// Restore preference
const savedTheme = localStorage.getItem('md-theme');
applyTheme(savedTheme ? savedTheme === 'dark' : true);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOAD FILE (local)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    editor.value = ev.target.result;
    render();
    sFile.textContent = file.name;
    toast(`Loaded: ${file.name}`);
  };
  reader.readAsText(file);
  fileInput.value = '';
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOAD FROM URL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadUrl(url, label) {
  try {
    toast('Loadingâ€¦');
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const text = await res.text();
    editor.value = text;
    render();
    const name = label || url.split('/').pop();
    sFile.textContent = name;
    toast(`Loaded: ${name}`);
  } catch (err) {
    toast(`Error: ${err.message}`);
  }
}

btnUrl.addEventListener('click', () => { urlOverlay.classList.add('open'); urlInput.focus(); });
btnUrlCancel.addEventListener('click', () => urlOverlay.classList.remove('open'));
urlOverlay.addEventListener('click', e => { if (e.target === urlOverlay) urlOverlay.classList.remove('open'); });

btnUrlLoad.addEventListener('click', () => {
  const url = urlInput.value.trim();
  if (!url) return;
  urlOverlay.classList.remove('open');
  loadUrl(url);
  urlInput.value = '';
});

urlInput.addEventListener('keydown', e => {
  if (e.key === 'Enter')  btnUrlLoad.click();
  if (e.key === 'Escape') urlOverlay.classList.remove('open');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOAD ARCHITECTURE.md (shortcut button)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
btnArch.addEventListener('click', () => loadUrl(ARCH_PATH, 'ARCHITECTURE.md'));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAG-TO-RESIZE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let dragging = false, dragStartX = 0, dragStartW = 0;

handle.addEventListener('mousedown', e => {
  dragging = true;
  dragStartX = e.clientX;
  dragStartW = editorPane.getBoundingClientRect().width;
  handle.classList.add('dragging');
  document.body.style.cursor = 'col-resize';
  document.body.style.userSelect = 'none';
});

document.addEventListener('mousemove', e => {
  if (!dragging) return;
  const mainW = document.getElementById('main').getBoundingClientRect().width - handle.offsetWidth;
  const newW  = Math.max(120, Math.min(mainW - 120, dragStartW + e.clientX - dragStartX));
  const pct   = (newW / mainW * 100).toFixed(2);
  editorPane.style.flex  = `0 0 ${pct}%`;
  previewPane.style.flex = `0 0 ${100 - parseFloat(pct)}%`;
});

document.addEventListener('mouseup', () => {
  if (!dragging) return;
  dragging = false;
  handle.classList.remove('dragging');
  document.body.style.cursor = '';
  document.body.style.userSelect = '';
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL SYNC  (editor scroll % â†’ preview scroll %)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
editor.addEventListener('scroll', () => {
  const pct = editor.scrollTop / Math.max(1, editor.scrollHeight - editor.clientHeight);
  previewScroll.scrollTop = pct * (previewScroll.scrollHeight - previewScroll.clientHeight);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INITIAL LOAD
   â€” try to fetch ARCHITECTURE.md from the same repo
   â€” fall back to DEFAULT_MD welcome screen
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
fetch(ARCH_PATH)
  .then(r => { if (!r.ok) throw new Error(); return r.text(); })
  .then(txt => { editor.value = txt; render(); sFile.textContent = 'ARCHITECTURE.md'; })
  .catch(() => { editor.value = DEFAULT_MD; render(); sFile.textContent = 'welcome'; });
</script>
</body>
</html>
